<nb-card>
  <nb-card-header>User Dashboard</nb-card-header>
  <nb-card-body>
    <h3>Hello, {{ email }}</h3>
    <p class="muted">Here’s a quick view of your alarms and recent activity.</p>
  </nb-card-body>
</nb-card>

<div class="grid">
  <nb-card *ngFor="let s of summary" class="stat">
    <nb-card-header>
      <nb-icon [icon]="s.icon"></nb-icon> {{ s.label }}
    </nb-card-header>
    <nb-card-body><h2>{{ s.value }}</h2></nb-card-body>
  </nb-card>

  <!-- Recent Activity -->
  <nb-card class="span-2">
    <nb-card-header>Recent Activity</nb-card-header>
    <nb-card-body>
      <ul class="recent">
        <li *ngFor="let r of recentActivity">
          <span class="time">{{ r.time }}</span>
          <span class="text">{{ r.text }}</span>
        </li>
      </ul>
    </nb-card-body>
  </nb-card>
</div>

<!-- Live (son 10 dk) -->
<nb-card>
  <nb-card-header style="display:flex;justify-content:space-between;align-items:center">
    <span>Live Alarms</span>
    <span class="chip">10m</span>
  </nb-card-header>

  <nb-card-body>
    <div class="flex" style="gap:16px; align-items:center; margin-bottom:8px;">
      <strong>Toplam Aktif (son 10 dk):</strong>
      <span class="badge">{{ (totalActive$ | async) ?? 0 }}</span>
    </div>

    <table class="table live" *ngIf="(recent$ | async) as recent; else empty">
      <colgroup><col><col><col><col></colgroup>
      <thead>
        <tr>
          <th>Time</th><th>Location</th><th>Level</th><th>Message</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let e of recent | slice:0:5">
          <td>
            <span title="event: {{ e.timestamp | date:'short' }}">
            {{ (e.arrivedAt || e.createdAt || e.timestamp) | date:'short' }}
            </span>
          </td>
          <td>{{ e.location }}</td>
          <td>
            <span [ngClass]="{
              'text-danger': e.level === 'CRITICAL',
              'text-warning': e.level === 'WARN',
              'text-info':    e.level === 'INFO'
            }">{{ e.level }}</span>
          </td>
          <td>{{ e.message }}</td>
        </tr>
      </tbody>
    </table>
    <ng-template #empty><em>Bağlantı bekleniyor…</em></ng-template>
  </nb-card-body>
</nb-card>